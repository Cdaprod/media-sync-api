<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>media-sync-api ‚Äî Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.09);
      --border: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --muted2: rgba(255,255,255,0.45);
      --brand: #7c3aed;   /* violet */
      --brand2:#22c55e;   /* green */
      --warn: #f59e0b;
      --bad:  #ef4444;
      --shadow: 0 16px 50px rgba(0,0,0,0.45);
      --radius: 18px;
      --radius2: 12px;
      --ring: 0 0 0 3px rgba(124,58,237,0.25);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--sans);
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(124,58,237,0.25), transparent 60%),
        radial-gradient(1000px 500px at 90% 10%, rgba(34,197,94,0.18), transparent 55%),
        radial-gradient(900px 500px at 50% 90%, rgba(59,130,246,0.12), transparent 60%),
        var(--bg);
      color: var(--text);
      overflow: hidden;
    }

    a { color: inherit; }
    code { font-family: var(--mono); }

    .app {
      height: 100%;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .mobile-only{ display:none; }

    .backdrop{
      position: fixed;
      inset:0;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(3px);
      opacity:0;
      pointer-events:none;
      transition: opacity 140ms ease;
      z-index:65;
    }
    .backdrop.show{ opacity:1; pointer-events:auto; }

    /* Top bar */
    .topbar{
      position: sticky;
      top:0;
      z-index: 40;
      backdrop-filter: blur(14px);
      background: rgba(11,16,32,0.72);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px 18px;
      max-width: 1400px;
      margin: 0 auto;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width: 240px;
      flex: 0 1 auto;
    }
    .brand-title{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .hamburger{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 9px 11px;
      cursor:pointer;
      display:none;
    }
    .hamburger:hover{ background: rgba(255,255,255,0.10); }
    .logo{
      width: 36px; height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(124,58,237,0.9), rgba(34,197,94,0.75));
      box-shadow: 0 10px 30px rgba(124,58,237,0.25);
    }
    .brand h1{
      margin:0;
      font-size: 16px;
      letter-spacing: 0.3px;
      font-weight: 750;
    }
    .brand .sub{
      margin-top: 2px;
      font-size: 12px;
      color: var(--muted);
    }

    .toolbar{
      display:flex;
      align-items:center;
      gap: 10px;
      flex: 1;
      justify-content: flex-end;
      min-width: 0;
    }

    .search{
      flex: 1;
      max-width: 560px;
      min-width: 200px;
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 6px 8px 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      position: relative;
      flex-wrap: wrap;
    }
    .search .filter-toggle{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 6px;
      margin-left: auto;
    }
    .search .filter-toggle.active{
      border-color: rgba(124,58,237,0.45);
      background: rgba(124,58,237,0.18);
    }
    .search-panel{
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: rgba(11,16,32,0.92);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px;
      box-shadow: var(--shadow);
      display: none;
      flex-direction: column;
      gap: 8px;
      z-index: 20;
    }
    .search-panel.open{ display:flex; }
    .search input{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 13px;
      flex: 1;
    }
    .search input::placeholder{ color: var(--muted2); }

    .pillbar{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }
    .action-buttons{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .tagfilter{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
    }
    .tagfilter input{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 12px;
    }
    .btn.toggle.active{
      border-color: rgba(124,58,237,0.45);
      background: rgba(124,58,237,0.18);
    }
    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      user-select:none;
      display:flex;
      align-items:center;
      gap: 8px;
      white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.09); border-color: rgba(255,255,255,0.16); }
    .btn:active{ transform: translateY(0px); }
    .btn.primary{ border-color: rgba(124,58,237,0.45); background: rgba(124,58,237,0.18); }
    .btn.good{ border-color: rgba(34,197,94,0.45); background: rgba(34,197,94,0.14); }
    .btn.bad{ border-color: rgba(239,68,68,0.45); background: rgba(239,68,68,0.14); }
    .btn[disabled]{ opacity: 0.55; cursor: not-allowed; transform: none; }

    .seg{
      display:flex;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow:hidden;
      background: rgba(255,255,255,0.05);
      flex: 0 0 auto;
      margin-left: auto;
    }
    .seg button{
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 9px 12px;
      font-size: 12px;
      cursor:pointer;
    }
    .seg button.active{
      background: rgba(255,255,255,0.10);
      color: var(--text);
    }

    /* Main layout */
    .main{
      flex: 1;
      min-height: 0;
      display:flex;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
      padding: 16px 18px 18px;
      gap: 14px;
    }

    .sidebar{
      width: 330px;
      min-width: 260px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(15,20,36,0.85);
      box-shadow: var(--shadow);
      overflow: hidden;
      display:flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
      z-index: 50;
    }

    .sidebar.sidebar-drawer{
      position: fixed;
      top: 70px;
      left: 0;
      height: calc(100% - 70px);
      width: min(420px, 100vw - 24px);
      max-width: 100%;
      transform: translateX(-105%);
      transition: transform 160ms ease;
      pointer-events: none;
      z-index: 90;
    }
    .sidebar.sidebar-drawer.is-open{
      transform: translateX(0%);
      pointer-events: auto;
    }

    .content{
      flex:1;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--panel);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      min-height: 0;
    }

    .section-h{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .section-h .section-title{
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 0;
    }
    .section-toggle{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      border-radius: 10px;
      padding: 4px 8px;
      font-size: 12px;
      cursor:pointer;
    }
    .section-toggle:hover{ background: rgba(255,255,255,0.10); }
    .section-body{
      display:block;
    }
    .section-body.collapsed{
      display:none;
    }
    .section-h h2{
      margin:0;
      font-size: 13px;
      letter-spacing: 0.35px;
      text-transform: uppercase;
      color: var(--muted);
    }
    .meta-line{
      font-size: 12px;
      color: var(--muted);
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      padding: 2px 6px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(255,255,255,0.06);
      color: var(--muted);
    }

    .scroll{
      flex: 1;
      overflow: auto;
      min-height: 0;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
    }
    .sidebar .scroll{
      flex: 1;
      min-height: 0;
      overflow-x: hidden;
      padding-bottom: 18px;
    }
    .content .scroll{
      flex: 1;
      min-height: 0;
    }
    .scroll::-webkit-scrollbar{ width: 10px; height: 10px; }
    .scroll::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.14); border-radius: 999px; border: 2px solid rgba(0,0,0,0); background-clip: padding-box; }
    .scroll::-webkit-scrollbar-track{ background: rgba(255,255,255,0.04); }

    /* Project chips */
    .chips{
      padding: 12px;
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .chip{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 12px;
      cursor:pointer;
      transition: background 120ms ease, transform 120ms ease, border-color 120ms ease;
      max-width: 100%;
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .chip:hover{ background: rgba(255,255,255,0.09); transform: translateY(-1px); }
    .chip.active{
      border-color: rgba(124,58,237,0.55);
      background: rgba(124,58,237,0.16);
      box-shadow: 0 0 0 3px rgba(124,58,237,0.12) inset;
    }
    .chip .dot{
      width: 8px; height: 8px; border-radius: 999px;
      background: rgba(255,255,255,0.25);
    }
    .chip.active .dot{
      background: linear-gradient(135deg, rgba(124,58,237,0.9), rgba(34,197,94,0.8));
    }
    .chip .name{
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 250px;
    }

    /* Sources */
    .sources{
      padding: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(255,255,255,0.05);
      padding: 10px 10px;
    }
    .card strong { font-size: 12px; }
    .card .small { font-size: 11px; color: var(--muted); margin-top: 4px; }
    .tagrow{ display:flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .tag{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(255,255,255,0.04);
    }
    .tag.good{ border-color: rgba(34,197,94,0.35); color: rgba(187,247,208,0.85); background: rgba(34,197,94,0.12); }
    .tag.bad{ border-color: rgba(239,68,68,0.35); color: rgba(254,202,202,0.85); background: rgba(239,68,68,0.12); }
    .stage-tree{
      display:grid;
      gap: 6px;
      margin-top: 10px;
    }
    .stage-item{
      display:flex;
      align-items:flex-start;
      gap: 8px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px;
      background: rgba(255,255,255,0.04);
      font-size: 11px;
      color: var(--muted);
    }
    .stage-item strong{ color: var(--text); }
    .stage-item input{ margin-top: 2px; }
    .stage-item.suggested{
      border-color: rgba(34,197,94,0.45);
      background: rgba(34,197,94,0.12);
      color: rgba(187,247,208,0.85);
    }
    .stage-path{
      font-size: 10px;
      color: var(--muted2);
    }

    /* Grid/List */
    .grid{
      padding: 14px;
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 12px;
    }
    .list{
      padding: 10px 12px;
      display:flex;
      flex-direction: column;
      gap: 8px;
    }

    .asset{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius2);
      overflow:hidden;
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      position: relative;
    }
    .asset:hover{ transform: translateY(-2px); background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.16); }

    .thumb{
      aspect-ratio: 16/10;
      background: rgba(255,255,255,0.04);
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      overflow:hidden;
    }
    .thumb img{
      width: 100%; height: 100%;
      object-fit: cover;
      display:block;
      filter: saturate(1.05) contrast(1.03);
    }
    .thumb .fallback{
      font-size: 12px;
      color: var(--muted);
      padding: 14px;
      text-align:center;
    }

    .asset .body{
      padding: 10px 10px 10px;
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .asset .title{
      font-size: 12px;
      font-weight: 650;
      line-height: 1.25;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .asset .sub{
      font-size: 11px;
      color: var(--muted);
      overflow:hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .badges{
      position:absolute;
      top: 10px; left: 10px;
      display:flex;
      gap: 6px;
      flex-wrap: wrap;
      max-width: calc(100% - 20px);
    }
    .badge{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.85);
      backdrop-filter: blur(8px);
    }
    .badge.kind-video{ border-color: rgba(59,130,246,0.35); }
    .badge.kind-image{ border-color: rgba(34,197,94,0.35); }
    .badge.kind-audio{ border-color: rgba(245,158,11,0.35); }
    .badge.kind-doc{ border-color: rgba(124,58,237,0.35); }
    .tagpill{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.88);
      white-space: nowrap;
    }
    .tagpill[data-color]{
      border-color: rgba(255,255,255,0.10);
    }
    .tagwrap{
      display:flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .selector{
      position:absolute;
      top: 10px; right: 10px;
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.25);
      backdrop-filter: blur(8px);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .selector input{ width: 16px; height: 16px; }

    .asset.selected{
      border-color: rgba(124,58,237,0.55);
      box-shadow: 0 0 0 3px rgba(124,58,237,0.12) inset;
    }

    /* List row variant */
    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px 10px;
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(255,255,255,0.05);
    }
    .row:hover{ border-color: rgba(255,255,255,0.16); background: rgba(255,255,255,0.07); }
    .row .mini{
      width: 86px; height: 54px;
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow:hidden;
      background: rgba(255,255,255,0.04);
      flex-shrink:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .row .mini img{ width:100%; height:100%; object-fit: cover; display:block; }
    .row .info{ flex:1; min-width:0; }
    .row .info .t{ font-size: 12px; font-weight: 650; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .row .info .s{ font-size: 11px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 4px; }
    .row .actions{ display:flex; align-items:center; gap: 8px; }
    .iconbtn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 12px;
      cursor:pointer;
    }
    .iconbtn:hover{ background: rgba(255,255,255,0.10); border-color: rgba(255,255,255,0.16); }
    .row .actions input{ width: 16px; height: 16px; }

    /* Inspector drawer */
    .drawer{
      position: fixed;
      top: 0; right: 0;
      height: 100%;
      width: min(520px, 100vw);
      background: transparent;
      border-left: 1px solid var(--border);
      box-shadow: var(--shadow);
      transform: translateX(110%);
      transition: transform 160ms ease;
      z-index: 78;
      display:flex;
      flex-direction: column;
      min-height: 0;
    }
    .drawer::before{
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(11,16,32,0.88);
      backdrop-filter: blur(16px);
      z-index: 0;
      pointer-events: none;
    }
    .drawer > *{
      position: relative;
      z-index: 1;
    }
    .drawer.open{ transform: translateX(0%); }
    .drawer-h{
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border);
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: 10px;
    }
    .drawer-h .title{
      min-width:0;
    }
    .drawer-h .title h3{
      margin:0;
      font-size: 14px;
      font-weight: 780;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 360px;
    }
    .drawer-h .title .sub{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 420px;
    }
    .xbtn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
    }
    .xbtn:hover{ background: rgba(255,255,255,0.10); }

    .drawer-body{
      padding: 14px;
      display:flex;
      flex-direction: column;
      gap: 12px;
      overflow:auto;
      min-height: 0;
    }
    .preview{
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(255,255,255,0.04);
      overflow:hidden;
    }
    .preview video, .preview img{
      width: 100%;
      height: auto;
      display:block;
      background: rgba(0,0,0,0.25);
    }

    .kv{
      border: 1px solid var(--border);
      border-radius: var(--radius2);
      background: rgba(255,255,255,0.04);
      padding: 10px;
      display:grid;
      grid-template-columns: 120px 1fr;
      gap: 8px 10px;
      font-size: 12px;
      align-items:center;
    }
    .kv .k{ color: var(--muted); }
    .kv .v{ color: var(--text); overflow-wrap:anywhere; }

    .drawer-actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }

    /* Bottom selection bar */
    .selectbar{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      z-index: 55;
      display:none;
      background: rgba(11,16,32,0.75);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      gap: 10px;
      align-items:center;
      max-width: min(980px, calc(100vw - 24px));
      width: fit-content;
    }
    .selectbar.show{ display:flex; }
    .selectbar .count{ font-size: 12px; color: var(--muted); }
    .selectbar .sep{ width: 1px; height: 18px; background: var(--border); margin: 0 2px; }
    .selectbar .btn{ padding: 8px 11px; }

    .mobile-fab{
      position: fixed;
      left: 16px;
      bottom: 18px;
      z-index: 70;
      border: 1px solid var(--border);
      background: rgba(11,16,32,0.82);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      cursor: pointer;
    }

    /* Toasts */
    .toasts{
      position: fixed;
      top: 74px;
      right: 16px;
      z-index: 80;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .toast{
      border: 1px solid var(--border);
      background: rgba(11,16,32,0.78);
      backdrop-filter: blur(14px);
      border-radius: 14px;
      padding: 10px 12px;
      min-width: 260px;
      max-width: 360px;
      box-shadow: var(--shadow);
      font-size: 12px;
      color: var(--text);
    }
    .toast .t{ font-weight: 700; margin-bottom: 3px; }
    .toast .m{ color: var(--muted); }
    .toast.good{ border-color: rgba(34,197,94,0.35); }
    .toast.warn{ border-color: rgba(245,158,11,0.35); }
    .toast.bad{ border-color: rgba(239,68,68,0.35); }

    /* Mobile */
    @media (max-width: 1180px){
      .topbar-inner{
        flex-direction: column;
        align-items: stretch;
      }
      .brand{ width: 100%; min-width: 0; }
      .toolbar{
        width: 100%;
        flex-wrap: wrap;
        justify-content: space-between;
      }
      .search{
        flex: 1 1 320px;
        max-width: none;
      }
      .pillbar{
        justify-content: flex-start;
      }
    }
    @media (max-width: 980px){
      .sidebar{ width: 320px; }
    }
    @media (max-width: 860px){
      body{ overflow:auto; }
      .main{ flex-direction: column; overflow:auto; }
      .sidebar{ display:block; width: 100%; }
      .content{ width: 100%; }
      .drawer{ width: 100vw; }
      .topbar-inner{ flex-direction: column; align-items: stretch; gap:10px; }
      .brand{ min-width: 0; width: 100%; }
      .hamburger{ display:block; }
      .toolbar{ width: 100%; flex-direction: column; align-items: stretch; }
      .search{ flex:1; max-width: none; width: 100%; }
      .pillbar{ width: 100%; justify-content: flex-start; }
      .action-buttons{ display:none; width: 100%; flex-direction: column; align-items: stretch; }
      .action-buttons.open{ display:flex; }
      .btn{ padding: 7px 10px; font-size:11px; }
      .seg button{ padding: 8px 10px; font-size:11px; }
      .topbar-inner{ padding: 12px 12px; }
      .grid{ gap: 10px; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
      .asset .title{ font-size: 11px; }
      .section-h{ padding: 12px 12px 9px; }
      .sidebar{ border-radius: 0; }
      .drawer{ height: 85%; top: auto; bottom: 0; border-left: none; border-top: 1px solid var(--border); transform: translateY(110%); right:0; width:100%; }
      .drawer.open{ transform: translateY(0%); }
      .sidebar.sidebar-drawer{ top: 58px; height: calc(100% - 58px); border-radius: 0; }
      .mobile-only{ display:block; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="topbar-inner">
        <div class="brand" title="LAN-only media-sync-api explorer">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div class="brand-title">
              <h1>media-sync-api</h1>
              <button id="sidebarToggle" class="hamburger mobile-only" type="button" aria-label="Toggle projects">‚ò∞</button>
            </div>
            <div class="sub">Explorer ‚Ä¢ projects ‚Üí ingest ‚Üí index ‚Üí preview ‚Üí Resolve</div>
          </div>
        </div>

        <div class="toolbar">
          <div class="search" role="search">
            <span class="kbd">‚åòK</span>
            <input id="q" placeholder="Search filename, path‚Ä¶ (client-side filter)" autocomplete="off" />
            <button id="filterToggle" class="filter-toggle" type="button" aria-expanded="false">Filters ‚ñæ</button>
            <div id="searchPanel" class="search-panel" role="dialog" aria-label="Advanced filters">
              <div class="tagfilter" role="search" aria-label="Tag filter">
                <span class="kbd">tags</span>
                <input id="tagFilter" placeholder="Filter tags (comma)" autocomplete="off" />
              </div>
              <div class="pillbar">
                <button id="tagModeBtn" class="btn toggle" type="button">All tags</button>
                <button id="noTagsBtn" class="btn toggle" type="button">Untagged</button>
              </div>
            </div>
          </div>

          <div class="pillbar">
            <button id="actionsToggle" class="btn mobile-only" type="button">‚ãØ Actions</button>
            <div id="actionButtons" class="action-buttons">
              <button id="refreshBtn" class="btn" type="button">‚Üª Refresh</button>
              <button id="pickUploadBtn" class="btn good" type="button">Ôºã Upload</button>
              <button id="sendResolveBtn" class="btn primary" type="button" disabled>‚á¢ Send to Resolve</button>
              <button id="tagSelBtn" class="btn" type="button" disabled>üè∑ Tag selected</button>
              <button id="clearSelBtn" class="btn" type="button" disabled>‚úï Clear</button>
            </div>
          </div>

          <div class="seg" aria-label="View mode">
            <button id="viewGrid" class="active" type="button">Grid</button>
            <button id="viewList" type="button">List</button>
          </div>
        </div>
      </div>
    </div>

    <div class="main">
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar">
        <div class="section-h">
          <div class="section-title">
            <button class="section-toggle" type="button" data-section-toggle="projects" aria-expanded="true">‚àí</button>
            <h2>Projects</h2>
          </div>
          <div class="meta-line">
            <span id="projCount">‚Ä¶</span>
            <span class="kbd">Click</span>
          </div>
        </div>
        <div id="sidebarScroll" class="scroll sidebar-scroll">
          <div class="section-body" data-section="projects">
            <div id="projects" class="chips"></div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="libraries" aria-expanded="true">‚àí</button>
              <h2>Libraries</h2>
            </div>
            <div class="meta-line">
              <span id="libCount">‚Ä¶</span>
              <span class="kbd">Bridge</span>
            </div>
          </div>
          <div class="section-body" data-section="libraries">
            <div id="libraries" class="chips"></div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="buckets" aria-expanded="true">‚àí</button>
              <h2>Buckets</h2>
            </div>
            <div class="meta-line">
              <span id="bucketCount">‚Ä¶</span>
              <button id="discoverBucketsBtn" class="btn" type="button" style="padding:4px 8px;font-size:10px;">Discover</button>
            </div>
          </div>
          <div class="section-body" data-section="buckets">
            <div id="buckets" class="chips"></div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="sources" aria-expanded="true">‚àí</button>
              <h2>Sources</h2>
            </div>
            <div class="meta-line"><span class="kbd">/api/sources</span></div>
          </div>
          <div class="section-body" data-section="sources">
            <div id="sources" class="sources"></div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="bridge" aria-expanded="true">‚àí</button>
              <h2>Bridge</h2>
            </div>
            <div class="meta-line"><span class="kbd">/api/bridge</span></div>
          </div>
          <div class="section-body" data-section="bridge">
            <div style="padding: 12px;">
              <div class="card">
                <strong>Bridge a host library</strong>
                <div class="tag" id="bridgeAgentStatus">Bridge ready</div>
                <div class="small" style="margin-top:6px;">Select a server-visible junction, scan, then commit.</div>
                <div style="display:grid; gap:8px; margin-top:10px;">
                  <select id="bridgeCandidate" style="padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);">
                    <option value="">Select a junction‚Ä¶</option>
                  </select>
                  <div style="display:flex; gap:8px; flex-wrap: wrap;">
                    <button id="bridgeStageBtn" class="btn" type="button" disabled>Stage scan</button>
                    <button id="bridgeCommitBtn" class="btn primary" type="button" disabled>Commit selection</button>
                    <button id="bridgeRefreshBtn" class="btn" type="button">Refresh</button>
                  </div>
                  <div class="small" id="bridgeStageStatus"></div>
                </div>
                <div id="bridgeStageTree" class="stage-tree"></div>
              </div>
              <div class="card" style="margin-top:12px;">
                <strong>Library actions</strong>
                <div class="small">Select a library in the sidebar to re-scan buckets or derive thumbs.</div>
                <div style="display:flex; flex-wrap: wrap; gap:8px; margin-top:10px;">
                  <button id="bridgeRescanBtn" class="btn" type="button">Rescan buckets</button>
                  <button id="bridgeDeriveBtn" class="btn" type="button">Re-derive thumbs</button>
                </div>
              </div>
            </div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="resolve" aria-expanded="true">‚àí</button>
              <h2>Resolve</h2>
            </div>
            <div class="meta-line"><span class="kbd">/api/resolve/open</span></div>
          </div>
          <div class="section-body" data-section="resolve">
            <div style="padding: 12px;">
              <div class="card">
                <strong>Mode</strong>
                <div class="small">Queue selected clips, then dispatch.</div>
                <div style="display:grid; grid-template-columns: 1fr; gap: 8px; margin-top: 10px;">
                  <label style="font-size:12px; color:var(--muted);">Project mode</label>
                  <select id="resolveProjectMode" style="padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);">
                    <option value="current">Use current project</option>
                    <option value="__select__">Let host choose</option>
                    <option value="__new__">Create new project</option>
                  </select>

                  <label style="font-size:12px; color:var(--muted);">Project name</label>
                  <input id="resolveProjectName" placeholder="P1-Public-Accountability"
                    style="padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);" />

                  <label style="font-size:12px; color:var(--muted);">New project name (if creating)</label>
                  <input id="resolveNewName" placeholder="P3-Editorial"
                    style="padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);" />

                  <label style="font-size:12px; color:var(--muted);">Action</label>
                  <select id="resolveMode" style="padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,0.05);color:var(--text);">
                    <option value="import">Import into media pool</option>
                    <option value="reveal_in_explorer">Reveal in Explorer/Finder</option>
                  </select>

                  <div class="small" id="resolveHint">Select clips to enable.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="section-h" style="border-top:1px solid var(--border);">
            <div class="section-title">
              <button class="section-toggle" type="button" data-section-toggle="upload" aria-expanded="true">‚àí</button>
              <h2>Upload</h2>
            </div>
            <div class="meta-line"><span class="kbd">/api/projects/*/upload</span></div>
          </div>
          <div class="section-body" data-section="upload">
            <div style="padding: 12px;">
              <div class="card">
                <strong>Upload to active project</strong>
                <div class="small" id="uploadCaption">Pick a project first.</div>
                <div style="display:flex; gap:10px; align-items:center; margin-top: 10px; flex-wrap: wrap;">
                  <input id="uploadFile" type="file" style="max-width: 100%; color: var(--muted);" />
                  <button id="uploadBtn" class="btn good" type="button" disabled>Upload</button>
                </div>
                <div class="small" id="uploadStatus" style="margin-top:8px;"></div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Content -->
      <section class="content">
        <div class="section-h">
          <h2 id="contentTitle">Media</h2>
          <div class="meta-line">
            <span id="mediaCount">0 items</span>
            <span>‚Ä¢</span>
            <span id="activePath" class="kbd">no project</span>
          </div>
        </div>

        <div class="scroll" id="mediaScroll">
          <div id="mediaGrid" class="grid"></div>
          <div id="mediaList" class="list" style="display:none;"></div>
        </div>
      </section>
    </div>

    <!-- Bottom selection bar -->
    <div id="selectBar" class="selectbar" role="status" aria-live="polite">
      <div class="count"><span id="selCount">0</span> selected</div>
      <div class="sep"></div>
      <button id="selPlayBtn" class="btn" type="button">‚ñ∂ Preview</button>
      <button id="selResolveBtn" class="btn primary" type="button">‚á¢ Send to Resolve</button>
      <button id="selClearBtn" class="btn" type="button">‚úï Clear</button>
    </div>


    <!-- Inspector drawer -->
    <aside id="drawer" class="drawer" aria-hidden="true">
      <div class="drawer-h">
        <div class="title">
          <h3 id="drawerTitle">‚Äî</h3>
          <div id="drawerSub" class="sub">‚Äî</div>
        </div>
        <button id="drawerClose" class="xbtn" type="button" aria-label="Close inspector">‚úï</button>
      </div>

      <div class="drawer-body">
        <div class="preview" id="drawerPreview"></div>

        <div class="drawer-actions">
          <button id="drawerPlay" class="btn" type="button">‚ñ∂ Play</button>
          <button id="drawerCopy" class="btn" type="button">‚ßâ Copy stream URL</button>
          <button id="drawerTag" class="btn" type="button">üè∑ Tag</button>
          <button id="drawerToggleSelect" class="btn primary" type="button">Ôºã Select</button>
        </div>

        <div class="kv" id="drawerKV"></div>
      </div>
    </aside>

    <!-- Toasts -->
    <div class="toasts" id="toasts"></div>
    <div id="sidebarBackdrop" class="backdrop"></div>
    <div id="drawerBackdrop" class="backdrop"></div>
  </div>

  <script>
    function toAbsoluteUrl(path){
      if (!path) return '';
      if (path.startsWith('http://') || path.startsWith('https://')) {
        return path;
      }
      return new URL(path, window.location.origin).toString();
    }
    window.mediaSyncExplorer = { toAbsoluteUrl };
  </script>
  <script type="module" src="/public/js/app.js"></script>
</body>
</html>
